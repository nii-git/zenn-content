---
title: "Goã®Echoãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’ECS Fargateã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
emoji: "ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go","aws","echo","ecs","fargate","vpc"]
published: false
---

ã­ã‚€ã„ã€‚ã¡ã‚ƒã‚“ã¨æ¨æ•²ã™ã‚‹ã“ã¨ã€‚

## æ¦‚è¦
Goè¨€èªã®Echoãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã¦é–‹ç™ºã‚’ã—ãŸéš›ã€ã©ã®ã‚ˆã†ã«ECS Fargateã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‹ã¾ã¨ã‚ãŸè¨˜äº‹ã§ã™ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã‚ã‹ã‚‹ã‘ã©ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå…¨ãã‚ã‹ã‚‰ãªã„...ã¨ã„ã†æ–¹ã‚’å¯¾è±¡ã«ã—ã¦ã„ã¾ã™ã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ã—ã¦ã„ãŸEchoãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

å‰æã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«dockerãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã“ã¨ã‚’æƒ³å®š

// æ··ãœã¦ã‚‚ã„ã„ã‹ã‚‚æ³¨æ„ç‚¹ã¨æ¦‚è¦ã€€çœ ã„ã‚“ã ã€€æœ4æ™‚ã‹ã‚‰æ›¸ã„ã¦ã‚‹ã‚“ã 

## æ³¨æ„ç‚¹
ä»Šå›ã®æ§‹æˆã§ã¯ECSã¨RDSã‚’public subnetã«é…ç½®ã—ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ã‚ˆã‚Šã‚»ã‚­ãƒ¥ã‚¢ãªæ§‹æˆã«ã™ã‚‹å ´åˆã¯ã€ECSã‚„RDSã‚’private subnetã«ç§»å‹•ã•ã›ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
Natã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚„[ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ](https://dev.classmethod.jp/articles/privatesubnet_ecs/)ã®ä½œæˆãŒå¿…è¦ã§ã™ã€‚

ã¾ãŸã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«çŠ¶ã§ã½ã¡ã½ã¡ã‚„ã£ã¦ã„ã‚‹ãŸã‚ã€IaCã§ä½œæˆã—ãŸã„æ–¹ã«ã¯ã€€//TODO

è¨˜äº‹ä¸­ã®urlã¯åŸºæœ¬çš„ã«regionãŒ`ap-northeast-1`ã®ã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚
ä»–ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½œæˆã™ã‚‹æ–¹ã¯ãƒªãƒ³ã‚¯ã‚’è¸ã¾ãšã«å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

## æ§‹æˆå›³


## 1. VPCè¨­å®š

### 1.1 VPCä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ãŠä½¿ã„ã®VPCã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#vpcs
- VPCã‚’ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ä½œæˆã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹: VPCã®ã¿
  - åå‰ã‚¿ã‚°: ã‚ã‹ã‚Šã‚„ã™ã„åå‰
  - IPv4 CICDãƒ–ãƒ­ãƒƒã‚¯: IPv4CIDRã®æ‰‹å‹•å…¥åŠ›
  - IPv4 CIDR: å¤§è¦æ¨¡ã§ã‚ã‚Œã°`10.0.0.0/16`, ä¸­è¦æ¨¡ã§ã‚ã‚Œã°`172.16.0.0/16`
    - ä»Šå›ã¯ä¸­è¦æ¨¡ãªã®ã§`172.16.0.0/16`ã‚’ä½¿ç”¨ã™ã‚‹
    - å‚è€ƒ: [VPC CIDR ãƒ–ãƒ­ãƒƒã‚¯](https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-cidr-blocks.html)
  - Ipv6CIDRãƒ–ãƒ­ãƒƒã‚¯: IPv6 CIDR ãƒ–ãƒ­ãƒƒã‚¯ãªã—
  - ãƒ†ãƒŠãƒ³ã‚·ãƒ¼: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ


### 1.2 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ã‚µãƒ–ãƒãƒƒãƒˆã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#subnets
- ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆã‚’é¸æŠ
- æ–°ã—ã„ã‚µãƒ–ãƒãƒƒãƒˆã‚’è¿½åŠ ã‚’é¸æŠ
- VPC ID: 1.1ã§ä½œæˆã—ãŸVPCã‚’é¸æŠ
- ã‚µãƒ–ãƒãƒƒãƒˆ 1 (2 å€‹ä¸­)ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚µãƒ–ãƒãƒƒãƒˆå: å¥½ããªåå‰
  - ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³: ap-northeast-1a
  - IPv4 VPC CIDR block: `172.16.0.0/16`
  - IPv4 subnet CIDR block: `172.16.10.0/24`
- ã‚µãƒ–ãƒãƒƒãƒˆ 2 (2 å€‹ä¸­)ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚µãƒ–ãƒãƒƒãƒˆå: å¥½ããªåå‰
  - ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³: ap-northeast-1c
  - IPv4 VPC CIDR block: `172.16.0.0/16`
  - IPv4 subnet CIDR block: `172.16.20.0/24`


### 1.3 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#RouteTables
- ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - åå‰: å¥½ããªåå‰
  - VPC: 1.1ã§ä½œæˆã—ãŸVPCã‚’é¸æŠ
- ä½œæˆå¾Œã€ä½œæˆã—ãŸãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠ > ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ > ã‚µãƒ–ãƒãƒƒãƒˆã®é–¢é€£ä»˜ã‘ã‚’ç·¨é›† ã‚’é¸æŠ
- 1.2ã§ä½œæˆã—ãŸã‚µãƒ–ãƒãƒƒãƒˆã‚’é¸æŠã—ã€ä¿å­˜

### 1.4 ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ã‚µãƒ–ãƒãƒƒãƒˆã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#subnets
- ã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œæˆã‚’é¸æŠ
- æ–°ã—ã„ã‚µãƒ–ãƒãƒƒãƒˆã‚’è¿½åŠ ã‚’é¸æŠ
- VPC ID: 1.1ã§ä½œæˆã—ãŸVPCã‚’é¸æŠ
- ã‚µãƒ–ãƒãƒƒãƒˆ 1 (2 å€‹ä¸­)ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚µãƒ–ãƒãƒƒãƒˆå: å¥½ããªåå‰
  - ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³: ap-northeast-1a
  - IPv4 VPC CIDR block: `172.16.0.0/16`
  - IPv4 subnet CIDR block: `172.16.30.0/24`
- ã‚µãƒ–ãƒãƒƒãƒˆ 2 (2 å€‹ä¸­)ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚µãƒ–ãƒãƒƒãƒˆå: å¥½ããªåå‰
  - ã‚¢ãƒ™ã‚¤ãƒ©ãƒ“ãƒªãƒ†ã‚£ãƒ¼ã‚¾ãƒ¼ãƒ³: ap-northeast-1c
  - IPv4 VPC CIDR block: `172.16.0.0/16`
  - IPv4 subnet CIDR block: `172.16.40.0/24`


### 1.5 ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#RouteTables
- ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - åå‰: å¥½ããªåå‰
  - VPC: 1.1ã§ä½œæˆã—ãŸVPCã‚’é¸æŠ
- ä½œæˆå¾Œã€ä½œæˆã—ãŸãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠ > ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ > ã‚µãƒ–ãƒãƒƒãƒˆã®é–¢é€£ä»˜ã‘ã‚’ç·¨é›† ã‚’é¸æŠ
- 1.4ã§ä½œæˆã—ãŸã‚µãƒ–ãƒãƒƒãƒˆã‚’é¸æŠã—ã€ä¿å­˜

### 1.6 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’ä½œæˆ
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#igws
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  -  åå‰: å¥½ããªåå‰
-  ä½œæˆå¾Œã€ä½œæˆã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’é¸æŠ > ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ > VPCã«ã‚¢ã‚¿ãƒƒãƒã‚’é¸æŠ
-  VPC: 1.1ã§é¸æŠã—ãŸVPC ã‚’é¸æŠ


### 1.7 ç¾åœ¨ã®çŠ¶æ…‹å›³
![ç¾åœ¨ã®çŠ¶æ…‹](/images/go-deploy-ecs/go-deploy-ecs1.jpg)


## 2. ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š
### 2.1 ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—
- Route53 > ãƒ‰ãƒ¡ã‚¤ãƒ³ > ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç™»éŒ²ã«ç§»å‹•
  - https://us-east-1.console.aws.amazon.com/route53/domains/home?region=ap-northeast-1#/
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç™»éŒ²ã‚’é¸æŠ
- ä½¿ç”¨ã—ãŸã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›
- æœŸé–“ã€è‡ªå‹•æ›´æ–°ã®æœ‰ç„¡ã‚’å…¥åŠ›
- é€£çµ¡å…ˆæƒ…å ±ã‚’å…¥åŠ›

### 2.2 è¨¼æ˜æ›¸ã‚’ä½œæˆ
- AWS Certificate Manager > è¨¼æ˜æ›¸ä¸€è¦§ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/acm/home?region=ap-northeast-1#/certificates/list
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - è¨¼æ˜æ›¸ã‚¿ã‚¤ãƒ—: ãƒ‘ãƒ–ãƒªãƒƒã‚¯è¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  - å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å: 2.1ã§ç™»éŒ²ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³å
  - æ¤œè¨¼æ–¹æ³•: DNSæ¤œè¨¼
  - ã‚­ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : RSA2048
- è©²å½“ã®è¨¼æ˜æ›¸ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ`æ¤œè¨¼ä¿ç•™ä¸­`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### 2.3 è¨¼æ˜æ›¸ã‚’æ¤œè¨¼
- 10åˆ†ç¨‹åº¦ã§2.1ã§ç™»éŒ²ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«Route 53ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ãŒå±Šã
  - é€ä¿¡å…ƒ: Amazon Route 53 (noreply@registrar.amazon.com)
  - ä»¶å: Verify your email address for {ãƒ‰ãƒ¡ã‚¤ãƒ³å}
- æœ¬æ–‡ä¸­ã«ã‚ã‚‹verify linkã‚’è¸ã‚ã°OK

### 2.4 ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
- 2.3ã§ä½œæˆã—ãŸè¨¼æ˜æ›¸ã®è©³ç´° > ãƒ‰ãƒ¡ã‚¤ãƒ³ > Route53ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã‚’é¸æŠ
- 2.1ã§ç™»éŒ²ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é¸æŠã—ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã‚’é¸æŠ
- 5åˆ†ç¨‹åº¦ã§è©²å½“ã®è¨¼æ˜æ›¸ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ`ç™ºè¡Œæ¸ˆã¿`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### 2.5 ç¾åœ¨ã®çŠ¶æ…‹å›³
![ç¾åœ¨ã®çŠ¶æ…‹](/images/go-deploy-ecs/go-deploy-ecs2.jpg)


## 3. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
### 3.1 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­å®š
- VPC > ä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ > ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#RouteTables:
- 1.3ã§ä½œæˆã—ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é¸æŠ > ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ > ãƒ«ãƒ¼ãƒˆã‚’ç·¨é›†
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - é€ä¿¡å…ˆ: `0.0.0.0/0`
  - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤/{1.6ã§ä½œæˆã—ãŸã‚‚ã®}

### 3.2 ELBç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
- VPC > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#SecurityGroups
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å: å¥½ããªåå‰
  - VPC: 1.1ã§ä½œæˆã—ãŸVPC
  - ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«1
    - ã‚¿ã‚¤ãƒ—: HTTP
    - ã‚½ãƒ¼ã‚¹: Anywhere-IPv4
  - ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«2
    - ã‚¿ã‚¤ãƒ—: HTTPS
    - ã‚½ãƒ¼ã‚¹: Anywhere-IPv4
  - ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«
    - ã‚¿ã‚¤ãƒ—: ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯
    - é€ä¿¡å…ˆ: Anywhere-IPv4


### 3.3 ECSç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
- VPC > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ > ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-1#SecurityGroups
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—å: å¥½ããªåå‰
  - VPC: 1.1ã§ä½œæˆã—ãŸVPC
  - ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«
    - ã‚¿ã‚¤ãƒ—: HTTP
    - ã‚½ãƒ¼ã‚¹: ã‚«ã‚¹ã‚¿ãƒ ã€3.2ã§ä½œæˆã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
  - ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«
    - ã‚¿ã‚¤ãƒ—: ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯
    - é€ä¿¡å…ˆ: Anywhere-IPv4


### 3.4 ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
- EC2 > ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° > ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#TargetGroups
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¿ã‚¤ãƒ—ã®é¸æŠ: IPã‚¢ãƒ‰ãƒ¬ã‚¹
  - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—å: å¥½ããªåå‰
  - ãƒ—ãƒ­ãƒˆã‚³ãƒ« : ãƒãƒ¼ãƒˆ: HTTP:80
  - IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¿ã‚¤ãƒ—: IPv4
  - VPC: 1.1ã§ä½œæˆã—ãŸVPC
  - ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³: HTTP1
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«: HTTP
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¹: /
  - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç™»éŒ²ã¯ä½•ã‚‚ã›ãšã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆã‚’é¸æŠ


### 3.5 ELBã®ä½œæˆ
- EC2 > ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° > ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/ec2/home?region=ap-northeast-1#LoadBalancers:
- ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š
  - ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚¿ã‚¤ãƒ—:Application Load Balancer
  - ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼å: å¥½ããªåå‰
  - ã‚¹ã‚­ãƒ¼ãƒ : ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‘ã‘
  - IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¿ã‚¤ãƒ—: IPv4
  - VPC: 1.1ã§ä½œæˆã—ãŸVPC
  - ãƒãƒƒãƒ”ãƒ³ã‚°: ap-northeast-1a, ap-northeast-1c(1.2ã§ä½¿ç”¨ã—ãŸ2å€‹ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã‚’é¸æŠ)
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—: 3.3ã§ä½œæˆã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
  - ãƒªã‚¹ãƒŠãƒ¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«,ãƒãƒ¼ãƒˆ: HTTPS/443
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³: è»¢é€å…ˆ 3.4ã§ä½œæˆã—ãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚«ãƒ†ã‚´ãƒª: å…¨ã¦ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼
  - ãƒãƒªã‚·ãƒ¼å: æ¨å¥¨ã®ã‚‚ã®
  - è¨¼æ˜æ›¸ã®å–å¾—å…ˆ: ACMã‹ã‚‰
  - è¨¼æ˜æ›¸(ACMã‹ã‚‰): 2.2ã§ä½œæˆã—ãŸè¨¼æ˜æ›¸


### 3.6 ç¾åœ¨ã®çŠ¶æ…‹å›³
![ç¾åœ¨ã®çŠ¶æ…‹](/images/go-deploy-ecs/go-deploy-ecs3.jpg)


## 4. ECRè¨­å®š
### 4.1 ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
- Amazon Elastic Container Registry > Private regisstry > Repositoriesã«ç§»å‹•
  - https://ap-northeast-1.console.aws.amazon.com/ecr/private-registry/repositories?region=ap-northeast-1
- ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã‚’é¸æŠ
- ä¸‹è¨˜ã®é€šã‚Šã«è¨­å®š
  - å¯è¦–åŒ–è¨­å®š: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ
  - ãƒªãƒã‚¸ãƒˆãƒªå: å¥½ããªåå‰


### 4.2 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã¦ã€dockerãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
  - 4.1ã§ä½œæˆã—ãŸãƒªãƒã‚¸ãƒˆãƒª > ãƒ—ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã®è¡¨ç¤ºã§ç¢ºèªã—ãŸæ–¹ãŒç¢ºå®Ÿã ãŒã€dockerã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«`--platform linux/x86_64`ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹
- ä¸‹è¨˜ãŒå®Œäº†ã—ãŸéš›ã€4.1ã§ä½œæˆã—ãŸãƒªãƒã‚¸ãƒˆãƒªã«latestã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹

```
docker build -t {APP_NAME} --platform linux/x86_64 .
docker tag {APP_NAME} {ACCOUNT_ID}.dkr.ecr.ap-northeast-1.amazonaws.com/{APP_NAME}
aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin {ACCOUNT_ID}.dkr.ecr.ap-northeast-1.amazonaws.com
docker push {ACCOUNT_ID}.dkr.ecr.ap-northeast-1.amazonaws.com/{APP_NAME}
```

### 4.3 ç¾åœ¨ã®çŠ¶æ…‹å›³
![ç¾åœ¨ã®çŠ¶æ…‹](/images/go-deploy-ecs/go-deploy-ecs4.jpg)